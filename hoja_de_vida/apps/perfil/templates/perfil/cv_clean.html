<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curriculum Vitae - {{ perfil.nombres }} {{ perfil.apellidos }}</title>
    {% load static %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'perfil/css/cv_clean.css' %}">
    <style>
        /* Sidebar and section visibility controls */
        .main-section { display: none; }
        #cv-sidebar {
            position: fixed;
            top: 0;
            left: -260px;
            width: 260px;
            height: 100%;
            background: #ffffff;
            box-shadow: 2px 0 8px rgba(0,0,0,0.12);
            transition: left 0.28s ease;
            z-index: 1200;
            padding: 20px;
        }
        #cv-sidebar.open { left: 0; }
        #cv-sidebar h3 { margin-top: 0; font-size: 18px; }
        .cv-section-btn { display: block; width: 100%; margin: 8px 0; padding: 10px 12px; border: none; background: #f3f4f6; cursor: pointer; text-align: left; border-radius: 6px; }
        .cv-section-btn:hover { background: #e5e7eb; }
        #menu-toggle { background: none; border: none; padding: 8px 12px; font-size: 20px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="cv-page">
        <!-- Floating CV sidebar (global toggle) -->
        <aside id="cv-sidebar" aria-hidden="true">
            <h3>Secciones</h3>
            <button id="sidebar-close" class="cv-section-btn" onclick="document.getElementById('cv-sidebar').classList.remove('open')">Cerrar ‚úï</button>
            {% if experiencias_qs.exists and perfil.visibilidad_secciones.mostrar_experiencia_laboral %}
                <button class="cv-section-btn" data-section="experiencia">Experiencia Laboral</button>
            {% endif %}
            {% if cursos.exists and perfil.visibilidad_secciones.mostrar_educacion_cursos %}
                <button class="cv-section-btn" data-section="educacion">Educaci√≥n y Cursos</button>
            {% endif %}
            {% if reconocimientos.exists and perfil.visibilidad_secciones.mostrar_reconocimientos %}
                <button class="cv-section-btn" data-section="reconocimientos">Reconocimientos</button>
            {% endif %}
            {% if productos_laborales.exists and perfil.visibilidad_secciones.mostrar_productos_laborales %}
                <button class="cv-section-btn" data-section="productos_laborales">Productos Laborales</button>
            {% endif %}
            {% if productos_academicos.exists and perfil.visibilidad_secciones.mostrar_productos_academicos %}
                <button class="cv-section-btn" data-section="productos_academicos">Productos Acad√©micos</button>
            {% endif %}
        </aside>
        <!-- HEADER PREMIUM -->
        <div class="cv-header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="full-name">{{ perfil.nombres }} {{ perfil.apellidos }}</h1>
                    {% if perfil.descripcionperfil %}
                        <p class="profession">{{ perfil.descripcionperfil }}</p>
                    {% endif %}
                </div>
                <div class="header-right no-print">
                    <button id="menu-toggle" class="btn-admin" aria-label="Abrir men√∫">‚ò∞</button>
                    <a href="{% url 'marketplace' %}" class="btn-admin">
                        <span class="admin-icon">üéÅ</span> Marketplace
                    </a>
                    <a href="{% url 'admin:index' %}" class="btn-admin">
                        <span class="admin-icon">‚öôÔ∏è</span> Admin
                    </a>
                </div>
            </div>
        </div>

        <!-- MAIN LAYOUT -->
        <div class="cv-body">
            <!-- LEFT COLUMN (MAIN CONTENT - 68%) -->
            <div class="cv-main">
                <!-- EXPERIENCIA LABORAL -->
                    {% if experiencias_qs.exists and perfil.visibilidad_secciones.mostrar_experiencia_laboral %}
                        <section id="experiencia" class="main-section">
                        <div class="section-header">
                            <div class="section-icon">üí™</div>
                            <h2 class="section-title">Experiencia Laboral</h2>
                        </div>
                        <div class="section-content">
                            {% for exp_group in experiencias %}
                                <div class="timeline-block">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <h3 class="company-name">{{ exp_group.empresa }}</h3>
                                        {% for exp in exp_group.experiencias %}
                                            <div class="experience-card">
                                                <div class="card-header">
                                                    {% if exp.cargodesempenado %}
                                                        <h4 class="position-title">{{ exp.cargodesempenado }}</h4>
                                                    {% endif %}
                                                    <span class="date-badge">
                                                        {% if exp.fechainiciogestion %}{{ exp.fechainiciogestion|date:"M Y" }}{% endif %}
                                                        {% if exp.fechafingestion %} - {{ exp.fechafingestion|date:"M Y" }}{% else %} - Presente{% endif %}
                                                    </span>
                                                </div>
                                                
                                                {% if exp.lugarempresa %}
                                                    <p class="location-tag">üó∫Ô∏è {{ exp.lugarempresa }}</p>
                                                {% endif %}
                                                
                                                {% if exp.descripcionfunciones %}
                                                    <p class="description-text">{{ exp.descripcionfunciones }}</p>
                                                {% endif %}

                                                {% if exp.emailempresa or exp.sitiowebempresa or exp.nombrecontactoempresarial or exp.telefonocontactoempresarial %}
                                                    <div class="contact-grid">
                                                        {% if exp.emailempresa %}
                                                            <div class="contact-item">
                                                                <span class="contact-icon">ÔøΩ</span>
                                                                <span class="contact-text">{{ exp.emailempresa }}</span>
                                                            </div>
                                                        {% endif %}
                                                        {% if exp.sitiowebempresa %}
                                                            <div class="contact-item">
                                                                <span class="contact-icon">üåü</span>
                                                                <a href="{{ exp.sitiowebempresa }}" target="_blank" class="contact-link">{{ exp.sitiowebempresa }}</a>
                                                            </div>
                                                        {% endif %}
                                                        {% if exp.nombrecontactoempresarial %}
                                                            <div class="contact-item">
                                                                <span class="contact-icon">ÔøΩ‚Äçüíº</span>
                                                                <span class="contact-text">{{ exp.nombrecontactoempresarial }}</span>
                                                            </div>
                                                        {% endif %}
                                                        {% if exp.telefonocontactoempresarial %}
                                                            <div class="contact-item">
                                                                <span class="contact-icon">üì±</span>
                                                                <span class="contact-text">{{ exp.telefonocontactoempresarial }}</span>
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                {% endif %}

                                                {% if exp.rutacertificado %}
                                                    <div class="cert-actions">
                                                        <a class="btn-cert primary" href="{% url 'ver_certificado_experiencia' exp.pk %}" target="_blank">
                                                            <span class="btn-icon">üîç</span> Ver certificado
                                                        </a>
                                                        <a class="btn-cert secondary" href="{% url 'ver_certificado_experiencia' exp.pk %}?download=1">
                                                            <span class="btn-icon">üíæ</span> Descargar
                                                        </a>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </section>
                {% endif %}

                <!-- EDUCACI√ìN Y CURSOS -->
                {% if cursos.exists and perfil.visibilidad_secciones.mostrar_educacion_cursos %}
                    <section id="educacion" class="main-section">
                        <div class="section-header">
                            <div class="section-icon">üéì</div>
                            <h2 class="section-title">Educaci√≥n y Cursos</h2>
                        </div>
                        <div class="section-content">
                            {% for curso in cursos %}
                                <div class="timeline-block">
                                    <div class="timeline-marker"></div>
                                    <div class="timeline-content">
                                        <div class="education-card">
                                            <div class="card-header">
                                                {% if curso.nombrecurso %}
                                                    <h4 class="course-title">{{ curso.nombrecurso }}</h4>
                                                {% endif %}
                                                <span class="date-badge">
                                                    {% if curso.fechainicio %}{{ curso.fechainicio|date:"M Y" }}{% endif %}
                                                    {% if curso.fechafin %} - {{ curso.fechafin|date:"M Y" }}{% endif %}
                                                </span>
                                            </div>
                                            
                                            {% if curso.entidadpatrocinadora %}
                                                <p class="institution-name">{{ curso.entidadpatrocinadora }}</p>
                                            {% endif %}
                                            
                                            {% if curso.totalhoras %}
                                                <p class="hours-badge">üïê {{ curso.totalhoras }} horas</p>
                                            {% endif %}
                                            
                                            {% if curso.descripcioncurso %}
                                                <p class="description-text">{{ curso.descripcioncurso }}</p>
                                            {% endif %}

                                            {% if curso.nombrecontactoauspicia or curso.telefonocontactoauspicia or curso.emailempresapatrocinadora %}
                                                <div class="contact-grid">
                                                    {% if curso.nombrecontactoauspicia %}
                                                        <div class="contact-item">
                                                            <span class="contact-icon">üßë</span>
                                                            <span class="contact-text">{{ curso.nombrecontactoauspicia }}</span>
                                                        </div>
                                                    {% endif %}
                                                    {% if curso.telefonocontactoauspicia %}
                                                        <div class="contact-item">
                                                            <span class="contact-icon">‚òéÔ∏è</span>
                                                            <span class="contact-text">{{ curso.telefonocontactoauspicia }}</span>
                                                        </div>
                                                    {% endif %}
                                                    {% if curso.emailempresapatrocinadora %}
                                                        <div class="contact-item">
                                                            <span class="contact-icon">üì¨</span>
                                                            <span class="contact-text">{{ curso.emailempresapatrocinadora }}</span>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            {% endif %}

                                            {% if curso.rutacertificado %}
                                                <div class="cert-actions">
                                                    <a class="btn-cert primary" href="{% url 'ver_certificado_curso' curso.pk %}" target="_blank">
                                                        <span class="btn-icon">üîé</span> Ver certificado
                                                    </a>
                                                    <a class="btn-cert secondary" href="{% url 'ver_certificado_curso' curso.pk %}?download=1">
                                                        <span class="btn-icon">üíø</span> Descargar
                                                    </a>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </section>
                {% endif %}

                <!-- RECONOCIMIENTOS -->
                {% if reconocimientos.exists and perfil.visibilidad_secciones.mostrar_reconocimientos %}
                    <section id="reconocimientos" class="main-section">
                        <div class="section-header">
                            <div class="section-icon">üèÖ</div>
                            <h2 class="section-title">Reconocimientos</h2>
                        </div>
                        <div class="section-content">
                            {% for recon in reconocimientos %}
                                <div class="award-card">
                                    {% if recon.tiporeconocimiento %}
                                        <span class="award-type">{{ recon.tiporeconocimiento }}</span>
                                    {% endif %}
                                    
                                    {% if recon.descripcionreconocimiento %}
                                        <h4 class="award-title">{{ recon.descripcionreconocimiento }}</h4>
                                    {% endif %}
                                    
                                    <div class="award-meta">
                                        {% if recon.entidadpatrocinadora %}
                                            <span class="award-entity">{{ recon.entidadpatrocinadora }}</span>
                                        {% endif %}
                                        {% if recon.fechareconocimiento %}
                                            <span class="award-date">{{ recon.fechareconocimiento|date:"d/m/Y" }}</span>
                                        {% endif %}
                                    </div>

                                    {% if recon.nombrecontactoauspicia or recon.telefonocontactoauspicia %}
                                        <div class="contact-grid compact">
                                            {% if recon.nombrecontactoauspicia %}
                                                <div class="contact-item">
                                                    <span class="contact-icon">ü§ù</span>
                                                    <span class="contact-text">{{ recon.nombrecontactoauspicia }}</span>
                                                </div>
                                            {% endif %}
                                            {% if recon.telefonocontactoauspicia %}
                                                <div class="contact-item">
                                                    <span class="contact-icon">üìü</span>
                                                    <span class="contact-text">{{ recon.telefonocontactoauspicia }}</span>
                                                </div>
                                            {% endif %}
                                        </div>
                                    {% endif %}

                                    {% if recon.rutacertificado %}
                                        <div class="cert-actions">
                                            <a class="btn-cert primary" href="{% url 'ver_certificado_reconocimiento' recon.pk %}" target="_blank">
                                                <span class="btn-icon">üîè</span> Ver certificado
                                            </a>
                                            <a class="btn-cert secondary" href="{% url 'ver_certificado_reconocimiento' recon.pk %}?download=1">
                                                <span class="btn-icon">üìÄ</span> Descargar
                                            </a>
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </section>
                {% endif %}

                <!-- PRODUCTOS ACAD√âMICOS -->
                {% if productos_academicos.exists and perfil.visibilidad_secciones.mostrar_productos_academicos %}
                    <section id="productos_academicos" class="main-section">
                        <div class="section-header">
                            <div class="section-icon">üìö</div>
                            <h2 class="section-title">Productos Acad√©micos</h2>
                        </div>
                        <div class="section-content">
                            {% for prod in productos_academicos %}
                                <div class="product-card">
                                    {% if prod.nombrerecurso %}
                                        <h4 class="product-title">{{ prod.nombrerecurso }}</h4>
                                    {% endif %}
                                    {% if prod.clasificador %}
                                        <span class="product-tag">{{ prod.clasificador }}</span>
                                    {% endif %}
                                    {% if prod.descripcion %}
                                        <p class="description-text">{{ prod.descripcion }}</p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </section>
                {% endif %}

                <!-- PRODUCTOS LABORALES -->
                {% if productos_laborales.exists and perfil.visibilidad_secciones.mostrar_productos_laborales %}
                    <section id="productos_laborales" class="main-section">
                        <div class="section-header">
                            <div class="section-icon">üõ†Ô∏è</div>
                            <h2 class="section-title">Productos Laborales</h2>
                        </div>
                        <div class="section-content">
                            {% for prod in productos_laborales %}
                                <div class="product-card">
                                    {% if prod.nombreproducto %}
                                        <h4 class="product-title">{{ prod.nombreproducto }}</h4>
                                    {% endif %}
                                    {% if prod.fechaproducto %}
                                        <span class="product-date">ÔøΩ {{ prod.fechaproducto|date:"d/m/Y" }}</span>
                                    {% endif %}
                                    {% if prod.descripcion %}
                                        <p class="description-text">{{ prod.descripcion }}</p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </section>
                {% endif %}

                <!-- VENTA GARAGE -->
                {% if ventas_garage.exists and perfil.visibilidad_secciones.mostrar_venta_garage %}
                    <section id="venta_garage" class="main-section">
                        <div class="section-header">
                            <div class="section-icon">üé™</div>
                            <h2 class="section-title">Venta Garage</h2>
                        </div>
                        <div class="section-content">
                            {% for venta in ventas_garage %}
                                <div class="garage-card">
                                    {% if venta.nombreproducto %}
                                        <h4 class="product-title">{{ venta.nombreproducto }}</h4>
                                    {% endif %}
                                    <div class="garage-meta">
                                        {% if venta.estadoproducto %}
                                            <span class="status-badge">{{ venta.estadoproducto }}</span>
                                        {% endif %}
                                        {% if venta.valorbien %}
                                            <span class="price-tag">${{ venta.valorbien }}</span>
                                        {% endif %}
                                    </div>
                                    {% if venta.descripcion %}
                                        <p class="description-text">{{ venta.descripcion }}</p>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </section>
                {% endif %}
            </div>

            <!-- RIGHT COLUMN (SIDEBAR VERDE - 32%) -->
            <aside class="cv-sidebar">
                <!-- Foto -->
                <div class="photo-container">
                    {% if perfil.foto_perfil_url %}
                        <img src="{{ foto_perfil_proxy_url|default:perfil.foto_perfil_url }}"
                            alt="Foto de perfil"
                            class="profile-photo">
                    {% else %}
                        <div class="profile-photo placeholder">
                            {{ perfil.nombres|first }}{{ perfil.apellidos|first }}
                        </div>
                    {% endif %}
                </div>

                <!-- Datos Personales -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">Datos Personales</h3>
                    <div class="sidebar-content">
                        {% if perfil.nacionalidad %}
                            <div class="info-item">
                                <span class="info-label">Nacionalidad</span>
                                <span class="info-value">{{ perfil.nacionalidad }}</span>
                            </div>
                        {% endif %}
                        {% if perfil.fechanacimiento %}
                            <div class="info-item">
                                <span class="info-label">Fecha de nacimiento</span>
                                <span class="info-value">{{ perfil.fechanacimiento|date:"d/m/Y" }}</span>
                            </div>
                        {% endif %}
                        {% if perfil.lugarnacimiento %}
                            <div class="info-item">
                                <span class="info-label">Lugar de nacimiento</span>
                                <span class="info-value">{{ perfil.lugarnacimiento }}</span>
                            </div>
                        {% endif %}
                        {% if perfil.sexo %}
                            <div class="info-item">
                                <span class="info-label">G√©nero</span>
                                <span class="info-value">{{ perfil.sexo }}</span>
                            </div>
                        {% endif %}
                        {% if perfil.estadocivil %}
                            <div class="info-item">
                                <span class="info-label">Estado civil</span>
                                <span class="info-value">{{ perfil.estadocivil }}</span>
                            </div>
                        {% endif %}
                        {% if perfil.numerocedula %}
                            <div class="info-item">
                                <span class="info-label">C√©dula</span>
                                <span class="info-value">{{ perfil.numerocedula }}</span>
                            </div>
                        {% endif %}
                        {% if perfil.licenciaconducir %}
                            <div class="info-item">
                                <span class="info-label">Licencia</span>
                                <span class="info-value">{{ perfil.licenciaconducir }}</span>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Contacto -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">Contacto</h3>
                    <div class="sidebar-content">
                        {% if perfil.telefonofijo %}
                            <div class="info-item icon">
                                <span class="icon-label">ÔøΩ</span>
                                <span class="info-value">{{ perfil.telefonofijo }}</span>
                            </div>
                        {% endif %}
                        {% if perfil.telefonoconvencional %}
                            <div class="info-item icon">
                                <span class="icon-label">üìû</span>
                                <span class="info-value">{{ perfil.telefonoconvencional }}</span>
                            </div>
                        {% endif %}
                        {% if perfil.sitioweb %}
                            <div class="info-item icon">
                                <span class="icon-label">üåç</span>
                                <a href="{{ perfil.sitioweb }}" target="_blank" class="info-link">{{ perfil.sitioweb }}</a>
                            </div>
                        {% endif %}
                        {% if perfil.direcciondomiciliaria %}
                            <div class="info-item icon">
                                <span class="icon-label">üè°</span>
                                <span class="info-value">{{ perfil.direcciondomiciliaria }}</span>
                            </div>
                        {% endif %}
                        {% if perfil.direcciontrabajo %}
                            <div class="info-item icon">
                                <span class="icon-label">üèõÔ∏è</span>
                                <span class="info-value">{{ perfil.direcciontrabajo }}</span>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Habilidades -->
                {% if habilidades %}
                <div class="sidebar-section">
                    <h3 class="sidebar-title">Habilidades</h3>
                    <div class="sidebar-content">
                        <div class="skills-container">
                            {% for habilidad in habilidades %}
                                <span class="skill-pill">{{ habilidad }}</span>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Intereses -->
                {% if intereses %}
                <div class="sidebar-section">
                    <h3 class="sidebar-title">Intereses</h3>
                    <div class="sidebar-content">
                        <p class="interests-text">{{ intereses }}</p>
                    </div>
                </div>
                {% endif %}
            </aside>
        </div>
    </div>

    <!-- CERTIFICADOS (p√°gina aparte) -->
    {% if certificates %}
        {% for cert in certificates %}
            <div class="cv-page certificate-page">
                <div class="certificate-wrapper">
                    <h2 class="certificate-title">{{ cert.title }}</h2>
                    <div class="certificate-frame">
                        <img src="{{ cert.image_url }}" alt="{{ cert.title }}" class="certificate-image">
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endif %}

    <!-- Botones de acci√≥n (solo al final) -->
    <div class="action-buttons">
        <button class="btn-action outline" onclick="window.print()" style="display: none;">
            <span class="btn-icon">ÔøΩÔ∏è</span> Imprimir PDF
        </button>
        <a class="btn-action primary" href="{% url 'descargar_cv_completo_pdf' %}?check_all=1">
            <span class="btn-icon">üìã</span> Check All
        </a>
        <a class="btn-action primary" href="{% url 'seleccionar_secciones_cv' %}">
            <span class="btn-icon">üìä</span> Descargar CV
        </a>
    </div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const sidebar = document.getElementById('cv-sidebar');
        const toggle = document.getElementById('menu-toggle');
        const sectionButtons = document.querySelectorAll('.cv-section-btn');

        if (toggle) {
            toggle.addEventListener('click', function (e) {
                e.stopPropagation();
                sidebar.classList.toggle('open');
            });
        }

        function hideAllSections() {
            document.querySelectorAll('.main-section').forEach(function (el) {
                el.style.display = 'none';
            });
        }

        // Show only experiencia on load
        hideAllSections();
        const experiencia = document.getElementById('experiencia');
        if (experiencia) experiencia.style.display = 'block';

        sectionButtons.forEach(function (btn) {
            btn.addEventListener('click', function (e) {
                e.stopPropagation();
                const section = btn.getAttribute('data-section');
                if (!section) return;
                hideAllSections();
                const target = document.getElementById(section);
                if (target) target.style.display = 'block';
                sidebar.classList.remove('open');
            });
        });

        // Close sidebar when clicking outside
        document.addEventListener('click', function (e) {
            if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
                sidebar.classList.remove('open');
            }
        });
    });
</script>
</html>